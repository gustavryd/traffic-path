include:
  - repo: gh:bluetext-io/bluetext
  - modules/nyc-traffic-viz

modules:
  traffic-api:
    image: node:20-alpine
    working_dir: /app
    ports:
      - "3000:3000"
    environment:
      PORT: "3000"
      NODE_ENV: "production"
    mounts:
      - path: /app
        source:
          type: host
          path: .
    command: |
      npm install
      npm start
    services:
      - id: traffic-api
        ports:
          - protocol: http
            port: 3000
            expose-as: 3000

tools:
  default:
    run:
      - tool: "nyc-traffic-viz"
  
  traffic-api:
    description: "Start the Node.js traffic data API service"
    run:
      - module: traffic-api
